#!/usr/bin/env bash
_np=/tmp/bashline
rm -f "$_np"
mkfifo "$_np" || exit 1
${BASHLINETERM:-xterm -title bashline -g 80x1+0+0@g -e} env _np="$_np" bash --rcfile <(cat <<'BASHRC'
  echo ok >"$_np"
  if [ -f /usr/share/bash-completion/bash_completion ]
    then . /usr/share/bash-completion/bash_completion
  elif [ -f /etc/bash_completion ]
    then . /etc/bash_completion
  fi
  bind -x '"\C-m": trap - EXIT; ${READLINE_LINE:-:} &>"$_np" & exit'
  trap 'printf >"$_np"' EXIT
  PS1= #"$(clear)"
BASHRC
) & read <"$_np"
$(command -v xprop || echo :) -name bashline -f _MOTIF_WM_HINTS 32c -set _MOTIF_WM_HINTS 0x2,0x0,0x0,0x0,0x0
exec cat "$_np"
