#!/usr/bin/env sh
[ '--' = "$1" ] && shift
file=$(realpath $@)
token=$(echo "$file" | tr / _)
info=/tmp/hx-sessions/$token
if [ -f "$info" ]
  then # existing instance
    read session_id window_id pane_id <$info
    if [ -z "$TMUX" ]
      then tmux attach-session -t "$session_id"
      else tmux switch-client -t "$session_id"
    fi
    tmux select-window -t "$window_id"
    tmux select-pane -t "$pane_id"
    tmux send-keys -l :o $file
    tmux send-keys Return
  else # new instance
    trap "echo rm '$info'" EXIT
    tmux display-message -p '#{session_id}:#{window_id}:#{pane_id}' >$info
    hx "$file"
fi
